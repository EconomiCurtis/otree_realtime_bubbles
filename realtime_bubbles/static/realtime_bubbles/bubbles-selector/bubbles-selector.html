<link rel="import" href="/static/bower_components/polymer/polymer.html">

<dom-module id="bubbles-selector">
	<template>
		<link rel="stylesheet" href="range.css">
		<style>
			:host {
				display: block;
			}
		</style>

		<canvas
			id="canvas"
			width$="[[ _width ]]px"
			height$="[[ _height ]]px"
			on-click="handleClick"
			>
		</canvas>

		<input
			id="input"
			type="range"
			min="0"
			max="1"
			step="0.005"
			disabled$="[[ disabled ]]"
			on-change="_inputValueChanged">
		<h3 align="center"><span>{{ value }}</span></h3>


	</template>
		

	<script src="BubblesCanvas.js"></script>
	<script>
		Polymer({
			// Create bubbles-selector object class:
			is: 'bubbles-selector',

			properties: {
		    	value: {
			        type: Number,
			    	notify: true,
			        observer: '_parentValueChanged',
		    	},
				groupDecisions: {
					type: Object,
				},
		    	disabled: {
		    		type: Boolean,
		    	},
				_width: {
					type: Number,
				},
				_height: {
					type: Number,
				},
			},

			handleClick(event) {
				var rect = this.$.canvas.getBoundingClientRect();
				const mousePos = {
					x: (event.clientX - rect.left),
					y: (event.clientY - rect.top)
				};

				x = mousePos.x;

				if (x > (this.clientWidth - 10)){
					x = 1.0
				} else if (x > 10){
					x = (x - 10) / (this.clientWidth - 20) // (x - {dot radius}) / (...)
					document.getElementById('input').value = x;
				} else {
					x = null
				};

				this.value = parseFloat(x);
			  	// round val to 3 digits
			  	this.value = ((x*100)/100).toFixed(3);


			},
			attached() {
				this._width = this.clientWidth;
				this._height = this.clientHeight;
		    	this._requestID = window.requestAnimationFrame(
		    		this._animate.bind(this));
			},
			detached() {
				window.cancelAnimationFrame(this._requestID);
			},
			_inputValueChanged(event) {
			  	this.value = parseFloat(event.target.value);
			  	// round val to 3 digits
			  	this.value = ((this.value*100)/100).toFixed(3);
			},
			_parentValueChanged(newValue, oldValue) {
				this.$.input.value = newValue;
			},
			_animate(timestamp) {
				//draw
				BubblesCanvas.draw(
					this.$.canvas.getContext('2d'),
					this.groupDecisions);

				this._requestID = window.requestAnimationFrame(
					this._animate.bind(this));
			}

		});
		//slider text
		$("#input").mousemove(function () {
		    $("#initial_action_text").text((($("#input").val()*100)/100).toFixed(3))
		});





	</script>
</dom-module>
