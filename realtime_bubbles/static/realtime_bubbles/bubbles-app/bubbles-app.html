<link rel="import" href="/static/bower_components/polymer/polymer.html">
<link rel="import" href="/static/bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<link rel="import" href="/static/otree-redwood/webcomponents/redwood-decision/redwood-decision.html">
<link rel="import" href="/static/otree-redwood/webcomponents/redwood-period/redwood-period.html">

<link rel="import" href="/static/realtime_bubbles/bubbles-selector/bubbles-selector.html">
<link rel="import" href="/static/realtime_bubbles/payoff-graph/payoff-graph.html">


<dom-module id="bubbles-app">
	<template>
		<style>
			#period-running-indicator {
				width: 30px;
				height: 30px;
				border-radius: 15px;
			}
			#period-running-indicator.period-running-true {
				background-color: #3c3;

			}
			#period-running-indicator.period-running-false {
				background-color: #f00;
			}
			bubbles-selector {
				width: 1000px;
				height: 400px;
			}
		</style>


	  <redwood-period
	      running="{{ isPeriodRunning }}">	      
	  </redwood-period>

    <redwood-decision
        my-decision="{{ myX }}"
        initial-decision="[[ initialX ]]"
		group-decisions="{{ groupDecisions }}"
        max-per-second="10">
    </redwood-decision>

    <div class="layout vertical">
    	<div
    		id="period-running-indicator"
    		class$="period-running-[[ isPeriodRunning ]]">
    	</div>
	    <bubbles-selector
	    	value="{{ myX }}"
	    	group-decisions="[[ groupDecisions ]]">
	    </bubbles-selector>
	    <payoff-graph></payoff-graph>
	  </div>

	</template>

	<script src="PayoffFunction.js"></script>
	<script>
		Polymer({
			is: 'bubbles-app',
			properties: {
				myPlannedDecision: {
					type: Number,
				},
				initialX: {
					type: Number,
					value: () => {
						return oTree.initial_action;
					}
				},
				myX: {
					type: Number,
				},
				groupDecisions: {
					type: Object,
				},
				isPeriodRunning: {
					type: Boolean,
				}
			},
		});
	</script>

<!-- <script>

	// onces the period start message is sent:
	document.querySelector('redwood-period').addEventListener('period-start', function(){

	    //countdown( "countdown", 0, {{ player.round_lengths|json }} );

	    document.querySelector('redwood-decision').groupDecisions[oTree.participantCode] = oTree.initial_action;
	    document.querySelector('redwood-decision').group_decisions = PayoffFunction.compute(
	    	document.querySelector('redwood-decision').groupDecisions, 
	    	oTree.payoff_function);
	    
	    // BubblesCanvas.draw(document.getElementById('canvas').getContext('2d'), oTree.groupDecisions); //draw


	});

</script> -->

</dom-module>